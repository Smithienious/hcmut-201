\documentclass[a4paper]{article}
\usepackage{a4wide,amssymb,epsfig,latexsym,multicol,array,hhline,fancyhdr}
\usepackage[utf8]{vntex, inputenc}
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{lastpage}
\usepackage[lined,boxed,commentsnumbered]{algorithm2e}
\usepackage{enumerate}
\usepackage{color}
\usepackage{graphicx}							% Standard graphics package
\usepackage{array}
\usepackage{tabularx, caption}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{rotating}
\usepackage{graphics}
\usepackage{geometry}
\usepackage{setspace}
\usepackage{epsfig}
\usepackage{tikz}
\usetikzlibrary{arrows,snakes,backgrounds}
\usepackage{hyperref}
\usepackage{indentfirst}
\usepackage{float}
\hypersetup{urlcolor=blue,linkcolor=black,citecolor=black,colorlinks=true}
%\usepackage{pstcol} 								% PSTricks with the standard color package

\newtheorem{theorem}{{\bf Theorem}}
\newtheorem{property}{{\bf Property}}
\newtheorem{proposition}{{\bf Proposition}}
\newtheorem{corollary}[proposition]{{\bf Corollary}}
\newtheorem{lemma}[proposition]{{\bf Lemma}}

\AtBeginDocument{\renewcommand*\contentsname{Contents}}
\AtBeginDocument{\renewcommand*\refname{References}}
%\usepackage{fancyhdr}
\setlength{\headheight}{40pt}
\pagestyle{fancy}
\fancyhead{} % clear all header fields
\fancyhead[L]{
  \begin{tabular}{rl}
    \begin{picture}(25,15)(0,0)
    \put(0,-8){\includegraphics[width=8mm, height=8mm]{hcmut.png}}
    %\put(0,-8){\epsfig{width=10mm,figure=hcmut.eps}}
    \end{picture}
	%\includegraphics[width=8mm, height=8mm]{hcmut.png} & %
    \begin{tabular}{l}
      \textbf{\bf \ttfamily University of Technology, Ho Chi Minh City}\\
      \textbf{\bf \ttfamily Faculty of Computer Science and Engineering}
    \end{tabular}
  \end{tabular}
}
\fancyhead[R]{
	\begin{tabular}{l}
		\tiny \bf \\
		\tiny \bf
	\end{tabular}  }
\fancyfoot{} % clear all footer fields
\fancyfoot[L]{\scriptsize \ttfamily Assignment for Mathematical Modeling\textendash{}Academic year 2020\textendash{}2021}
\fancyfoot[R]{\scriptsize \ttfamily Page {\thepage}/\pageref{LastPage}}
\renewcommand{\headrulewidth}{0.3pt}
\renewcommand{\footrulewidth}{0.3pt}


%%%
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{3}
\makeatletter
\newcounter{subsubsubsection}[subsubsection]
\renewcommand\thesubsubsubsection{\thesubsubsection.\@alph\c@subsubsubsection}
\newcommand\subsubsubsection{\@startsection{subsubsubsection}{4}{\z@}%
                                     {-3.25ex\@plus-1ex \@minus-.2ex}%
                                     {1.5ex \@plus.2ex}%
                                     {\normalfont\normalsize\bfseries}}
\newcommand*\l@subsubsubsection{\@dottedtocline{3}{10.0em}{4.1em}}
\newcommand*{\subsubsubsectionmark}[1]{}
\makeatother

\everymath{\color{blue}}

\begin{document}

\begin{titlepage}
  \begin{center}
    VIETNAM NATIONAL UNIVERSITY, HO CHI MINH CITY \\
    UNIVERSITY OF TECHNOLOGY \\
    FACULTY OF COMPUTER SCIENCE AND ENGINEERING
  \end{center}

  \vspace{1cm}

  \begin{figure}[h!]
    \begin{center}
      \includegraphics[width=3cm]{hcmut.png}
    \end{center}
  \end{figure}

  \vspace{1cm}


  \begin{center}
    \begin{tabular}{c}
      \multicolumn{1}{l}{\textbf{{\Large MATHEMATICAL MODELING  (CO2011)}}}               \\
      {}                                                                                  \\
      \hline
      \\
      \multicolumn{1}{l}{\textbf{{\Large Assignment (Semester 201, Duration: 06 weeks)}}} \\
      \\
      \textbf{{\Huge Dynamical systems in forecasting}}                                   \\
      \\
      \textbf{{\Huge Greenhouse Micro-climate}}                                           \\
      \\
      \hline
    \end{tabular}
  \end{center}

  \vspace{3cm}

  \begin{table}[h]
    \begin{tabular}{rrl}
      \hspace{5 cm} & Advisor: & Nguyễn Tiến Thịnh \\
                    &          & Nguyễn An Khương  \\
                    & TA:      & Trần Trung Hiếu   \\
    \end{tabular}
  \end{table}

  \begin{center}
    {\footnotesize HO CHI MINH CITY, DECEMBER 2020}
  \end{center}
\end{titlepage}


%\thispagestyle{empty}

\newpage
\tableofcontents
\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Member list \& Workload}

\begin{center}
  \begin{tabular}{|c|c|c|l|c|}
    \hline
    \textbf{No.}       & \textbf{Fullname}                      & \textbf{Student ID}      & \textbf{Problems}                             & \textbf{Percentage of work} \\
    \hline
    %%%%%Student 1%%%%%%%%%%
    \multirow{3}{*}{1} & \multirow{3}{*}{Lưu Nguyễn Hoàng Minh} & \multirow{3}{*}{1952845} & \textendash{} Relation \& Counting: 1, 2, 3   & \multirow{3}{*}{20\%}       \\
                       &                                        &                          & Bonus: 1, 2, 3.                               &                             \\
                       &                                        &                          & \textendash{} Probability: 1, 2, 3.           &                             \\
    \hline
    %%%%%Student 2%%%%%%%%%%%
    \multirow{3}{*}{2} & \multirow{3}{*}{Vũ Anh Nhi}            & \multirow{3}{*}{1952380} & \textendash{} Relation \& Counting: 4, 5, 6   & \multirow{3}{*}{20\%}       \\
                       &                                        &                          & Bonus: 4, 5, 6.                               &                             \\
                       &                                        &                          & \textendash{} Graph: 1, 2, 3, Bonus: 1, 2, 3. &                             \\
    \hline
    %%%%%Student 3%%%%%%%%%%%
    \multirow{3}{*}{3} & \multirow{3}{*}{Nguyễn Phú Nghĩa}      & \multirow{3}{*}{1952355} & \textendash{} Relation \& Counting: 4, 5, 6   & \multirow{3}{*}{20\%}       \\
                       &                                        &                          & Bonus: 4, 5, 6.                               &                             \\
                       &                                        &                          & \textendash{} Graph: 1, 2, 3, Bonus: 1, 2, 3. &                             \\
    \hline
    %%%%%Student 4%%%%%%%%%%%
    \multirow{3}{*}{4} & \multirow{3}{*}{Nguyễn Chính Khôi}     & \multirow{3}{*}{1952793} & \textendash{} Relation \& Counting: 4, 5, 6   & \multirow{3}{*}{20\%}       \\
                       &                                        &                          & Bonus: 4, 5, 6.                               &                             \\
                       &                                        &                          & \textendash{} Graph: 1, 2, 3, Bonus: 1, 2, 3. &                             \\
    \hline
    %%%%%Student 5%%%%%%%%%%%
    \multirow{3}{*}{5} & \multirow{3}{*}{Nguyễn Hoàng}          & \multirow{3}{*}{1952255} & \textendash{} Relation \& Counting: 4, 5, 6   & \multirow{3}{*}{20\%}       \\
                       &                                        &                          & Bonus: 4, 5, 6.                               &                             \\
                       &                                        &                          & \textendash{} Graph: 1, 2, 3, Bonus: 1, 2, 3. &                             \\
    \hline
  \end{tabular}
\end{center}


\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Exercise 1}
\subsection{A brief about dynamical systems}
A dynamical system is any system that evolves or changes with respect to time according to some rules.
A state space, also called the phase space, is a model used within dynamical systems to capture these changes.
For investigating dynamical systems, it is necessary to specify some characteristics that provide a subdivision into special classes of dynamical systems.

Dynamical systems are often classified as continuous or discrete.
Continuous systems (also called flows) are given by differential equations.
In such systems, the time intervals between measurements are negligibly small, making changes appear as one long continuum.
Then there are discrete systems (also called maps), which are specified by difference equations.

Another important characteristic of a dynamical system is whether it is time dependent or not.
For time-dependent systems, the function that specifies \(\dot{x}\) or \(\Delta{x_n}\) depends on the time itself, whereas in time-independent systems, this function does not change.

For the analysis, it is important whether a dynamical system is linear or not.
Linear dynamical systems are simple to analyze, unlike non-linear systems, which typically have intricate dynamical behavior.

A general dynamical system contains 2 elements: the initial state and a function or functions describing the next state.
We can choose any point in the state space to be the origin, then depending on the requirements, our functions can be differential or difference.
\begin{equation*}
  \begin{cases}
    a_0           & = C \\
    \frac{da}{dt} & = f
  \end{cases}
\end{equation*}
or
\begin{equation*}
  \begin{cases}
    a_0       & = C       \\
    a_{n + 1} & = a_n + X
  \end{cases}
\end{equation*}
with \(f\) is an arbitrary function or functions, \(C\) and \(X\) are arbitrary constants.

In this assignment, we are required to design first-order differential systems to predict the climate inside an arbitrary greenhouse.
The main climatic components of a greenhouse include temperature, vapor pressure of water and the \(CO_2\) concentration.
These components are are normally affected by one or many elements present inside the greenhouse, thus we will express these components in terms of differential equations.
\begin{itemize}
  \item Temperature
        \begin{multline}
          cap_{Can}\dot{T_{Can}} = {}R_{PAR\_SunCan} + R_{NIR\_SunCan} + R_{PipeCan} \\
          - H_{CanAir} - L_{CanAir} - R_{CanCov,in} \\
          - R_{CanFlr} - R_{CanSky} - R_{CanThScr} ~~~~ [W\;m^{-2}]
        \end{multline}
        \begin{multline}
          cap_{Air}\dot{T_{Air}} = H_{CanAir} + H_{PadAir} + H_{MechAir} + H_{PipeAir} \\
          + H_{PadAir} + H_{BlowAir} + R_{Glob\_SunAir} \\
          - H_{AirFlr} - H_{AirThScr} - H_{AirOut} \\
          - H_{AirTop} - H_{AirOut\_Pad} - L_{AirFog} ~~~~ [W\;m^{-2}]
        \end{multline}
        \begin{multline}
          cap_{Flr}\dot{T_{Flr}} = H_{AirFlr} + R_{PAR\_SunFlr} + R_{NIR\_SunFlr} + R_{CanFlr} + R_{PipeFlr} \\
          - H_{FlrSo1} - R_{FlrCov,in} - R_{FlrSky} - R_{FlrThScr} ~~~~ [W\;m^{-2}]
        \end{multline}
        \begin{multline}
          cap_{So(j)}T_{So(j)} = H_{So(j-1)So_{(j)}} - H_{So(j)So(j+1)} ~~~~~~~~~~~~~~~~ j=1,2\dots5 ~~~~ [W\;m^{-2}]
        \end{multline}
        \begin{multline}
          cap_{ThScr}\dot{T_{ThScr}} = H_{AirThScr} + L_{AirThScr} \\
          + R_{CanThScr} + R_{FlrThScr} + R_{PipeThScr} \\
          - H_{ThScrTop} - R_{ThScrCov,in} - R_{ThScrSky} ~~~~ [W\;m^{-2}]
        \end{multline}
        \begin{multline}
          cap_{Top}\dot{T_{Top}} = H_{ThScrTop} + H_{AirTop} - H_{TopCov,in} - H_{TopOut} ~~~~~~~~~~~~~~~~ [W\;m^{-2}]
        \end{multline}
        \begin{multline}
          cap_{Cov,in}\dot{T_{Cov,in}} = H_{TopCov,in} + L_{TopCov,in} + R_{CanCov,in} + R_{FlrCov,in} \\
          + R_{PipeCov,in} + R_{ThScrCov,in} - H_{Cov,inCov,e} ~~~~ [W\;m^{-2}]
        \end{multline}
        \begin{multline}
          cap_{Cov,e}\dot{T_{Cov,e}} = R_{Glob\_SunCov} + H_{Cov,inCov,e} - H_{Cov,eOut} - R_{Cov,eSky} ~~~~ [W\;m^{-2}]
        \end{multline}
        \begin{multline}
          cap_{Pipe}\dot{T_{Pipe}} = H_{BoilPipe} + H_{IndPipe} + H_{GeoPipe} \\
          - R_{PipeSky} - R_{PipeCov,in} - R_{PipeCan} \\
          - R_{PipeFlr} - R_{PipeThScr} - H_{PipeAir} ~~~~ [W\;m^{-2}]
        \end{multline}
  \item Vapor pressure
        \begin{multline}
          cap_{VP_{Air}}\dot{VP_{Air}} = MV_{CapAir} + MV_{PadAir} + MV_{FogAir} + MV_{BlowAir} \\
          - MV_{AirThScr} - MV_{AirTop} - MV_{AirOut} \\
          - MV_{AirOut\_Pad} - MV_{AirMech} ~~~~~~~~~~~~ [kg\;m^{-2}\;s^{-1}]
        \end{multline}
        \begin{multline}
          cap_{VP_{Top}}\dot{VP_{Top}} = MV_{AirTop} - MV_{TopCov,in} - MV_{TopOut} ~~~~~~~~~~~~ [kg\;m^{-2}\;s^{-1}]
        \end{multline}
  \item \(CO_2\) concentration
        \begin{multline}
          cap_{CO_{2Air}}\dot{CO_{2Air}} = MC_{BlowAir} + MC_{ExtAir} + MC_{PadAir} \\
          - MC_{AirCan} - MC_{AirTop} - MC_{AirOut} ~~~~ [mg\;m^{-2}\;s^{-1}]
        \end{multline}
        \begin{multline}
          cap_{CO_{2Top}}\dot{CO_{2Top}} = MC_{AirTop} - MC_{TopOut} ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ [mg\;m^{-2}\;s^{-1}]
        \end{multline}
\end{itemize}


\subsection{Necessary and sufficient conditions for this dynamical system}
All of the differential equations in the dynamical system above are/can be transformed into in the form of:
\begin{equation*}
  \begin{cases}
    \frac{dy}{dx} & = f(x,y) \\
    y(x_0)        & = y_0
  \end{cases}
\end{equation*}

The Existence and Uniqueness Theorem states that:

- Let \(f(x,y)\) be a function which is continuous on the rectangle  \(R = \{(x, y); |x - x_0| \leq a, |y - y_0| \leq b\) \}.
Assume \(f\) has a partial derivative with respect to \(y\) and that \(\frac{\partial f}{\partial y}\) is also continuous on the rectangle \(R\).
Then there exists an interval \(I=[x_0-h, x_0+h]\) (with \(h \leq a\)) such that the initial value problem
\begin{equation*}
  \begin{cases}
    \frac{dy}{dx} & = f(x,y) \\
    y(x_0)        & = y_0
  \end{cases}
\end{equation*}
has a unique solution \(y(x)\) defined on the interval \(I\).


\subsection{Examples of solvable first-order differential equations with exact solutions}
% howellkb.uah.edu
% math.hawaii.edu
- First equation:
\begin{equation*}
  \begin{cases}
    \frac{dy}{dx} & = - \frac{x}{y - 3} \\
    y(0)          & = 1
  \end{cases}
\end{equation*}
Here, \(\frac{dy}{dx} = f(x)g(y)\) with \(f(x) = -x\) and \(g(y) = \frac{1}{y-3}\)
\begin{align*}
  (y - 3) \frac{dy}{dx}                                     & = -x                                                \\
  {\color{black}\Leftrightarrow} ~~~ (y - 3) dy             & = -x dx                                             \\
  {\color{black}\Leftrightarrow}  \int (y - 3) dy           & = -\int xdx                                         \\
  {\color{black}\Leftrightarrow} ~~~~ \frac {1}{2} y^2 - 3y & = \frac{1}{2} x^2 + C                               \\
  {\color{black}\Rightarrow} ~~~~~~~~~~~~~~ y               & = \frac{-(-6) \pm \sqrt{{(-6)}^2 - 4(x^2 - 2C)}}{2} \\
                                                            & = 3 \pm \sqrt{9 - x^2 + 2C}
\end{align*}
With \(a = 9 + 2c\)
\begin{gather*}
  y = 3 \pm \sqrt{a - x^2}
\end{gather*}
Combining the general solution with the given initial value, we obtain
\begin{gather*}
  1 = y(0) = 3 \pm \sqrt{a - 0^2} = 3 \pm \sqrt{a} \\
  a = 4
\end{gather*}
Thus, the particular solution is
\begin{gather*}
  y = 3 - \sqrt{4-x^2}
\end{gather*} \\

- Second equation:
\begin{equation*}
  \begin{cases}
    3xy' - y & = lnx + 1, (x > 0) \\
    y(1)     & = -2
  \end{cases}
\end{equation*}
With \(x > 0\), we write the equation in standard form:
\begin{gather*}
  y' - \frac{1}{3x}y = \frac{lnx + 1}{3x}
\end{gather*}
Then the integrating factor is given by
\begin{gather*}
  v = e^{\int -dx/3x} = e^{(-1/3)lnx},\;x > 0
\end{gather*}
Thus
\begin{gather*}
  vy = x^{-1/3} y = \frac{1}{3} \int(lnx + 1) x^{-4/3} dx
\end{gather*}
Integration by parts of the right-hand side gives
\begin{gather*}
  x^{-1/3}y = -x^{-1/3}(lnx+1) + \int x^{-4/3}dx + C
\end{gather*}
Therefore
\begin{gather*}
  x^{-1/3}y = -x^{-1/3}(lnx+1) - 3x^{-1/3} + C
\end{gather*}
or, solving for \(y\),
\begin{gather*}
  y = -(lnx + 4) + Cx^{1/3}
\end{gather*}
When \(x = 1\) and \(y = -2\) this last equation becomes
\begin{gather*}
  -2 = -(0+4) + C \\
  \Leftrightarrow C = 2
\end{gather*}
Substitution into the equation for \(y\) gives the particular solution
\begin{gather*}
  y = 2x^{1/3} - lnx - 4
\end{gather*}


\subsection{An approach to Euler and Runge-Kutta algorithms}
\subsubsection{Explicit Euler algorithm}
As a reminder, our general first-order differential equations take the form
\begin{equation*}
  \begin{cases}
    \frac{dy}{dt} = f(y,t) \\
    y(t_0) = y_0
  \end{cases}
\end{equation*}

Regarding the definition of first order derivative of a function, we have:
\begin{gather*}
  \frac{dy}{dt} = \lim_{\Delta t \rightarrow 0} \frac{y(t + \Delta t) - y(t)}{\Delta t}
\end{gather*}

Thus, when \(\Delta t\) is sufficiently small - denoted \(h\), we can have the following approximation:
\begin{gather*}
  \frac{dy}{dt} \approx \frac{y(t + h) - y(t)}{h}
\end{gather*}

Combining with the first-order differential equation, we have:
\begin{gather*}
  f(y(t),t) \approx \frac{y(t + h) - y(t)}{h}
\end{gather*}

So, when we have \(y(t_1)\) and an arbitrarily small \(h\), we have approximate \(y(t_1 + h)\) by:
\begin{gather*}
  y(t + h) \approx y(t) + h \cdot f(y(t),t)
\end{gather*}

In the end, if we divide our time interval into discrete time steps, starting from \(t_0\) and \(t_i = t_{i-1} + h\), we can calculate \(y(t_i)\) at any \(t_i\) since our general first-order differential equations have provided us with the initial condition \(y(t_0) = y_0\). To put it more formally, we have:
\begin{gather*}
  y(t_{i+1}) \approx y(t_i) + h \cdot f(y(t_i), t_i)
\end{gather*}

That is the approximation steps of the Explicit Euler algorithm to solve general first-order differential equations.

\subsubsection{Explicit Runge–Kutta of order 4 algorithm}

% TODO

\subsection{Applying Euler and Runge-Kutta algorithms in this system}

% TODO


\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Exercise 2}
\subsection{\(CO_2\) concentration model}
\subsubsection{\(CO_2\) exchange}
To describe the concentration of \(CO_2\) in the greenhouse air, we consider a green house with thermal screens, which allow us to control light, temperature and humidity more precisely, which means a better climate control in the greenhouse.
\begin{figure}[H]
  \centering
  \includegraphics[width=11cm]{thrscr.png}
  \caption{Greenhouse thermal screen}\label{fig:thrscr}
\end{figure}

In figure~\ref{fig:thrscr}, we see that a thermal screen divides the green house into two compartments, above and below the screen.
This results in different concentrations of \(CO_2\) in two of the compartments.
\begin{figure}[H]
  \centering
  \includegraphics[width=9cm]{CO2}
  \caption{The CO2 flow inside and outside a greenhouse}\label{fig:CO2}
\end{figure}

The exchange in concentrations of \(CO_2\) can be separated into three \(CO_2\) region: \(CO_{2Top}\) which is from above the screen, \(CO_{2Air}\) which is from below the screen and \(CO_{2Out}\) which is from outside the greenhouse.
Each relates to each other in the diagram shown in figure~\ref{fig:CO2}.

%%%%%%%%%%
\subsubsection{Dynamical systems and assumptions}
From figure~\ref{fig:CO2}, the fluctuation of \(CO_2\) concentration in the lower and upper compartments of the greenhouse is represented by two differential equations.
\begin{equation}
  \begin{cases}
    cap_{CO_2 Air}\dot{CO_{2 Air}} = MC_{BlowAir} + MC_{ExtAir} + MC_{PadAir} \\ \qquad \qquad \qquad \qquad \qquad
    - MC_{AirCan} - MC_{AirTop} - MC_{AirOut}                                 \\
    cap_{CO_2 Top}\dot{CO_{2 Top}} = MC_{AirTop} - MC_{TopOut}
  \end{cases}
\end{equation}

The notations \(cap_A, CO_{2 A}, \dot{CO_2}_A\) and \(MC_{AB}\) are respectively the capacity to store \(CO_2\) in \(A\) \((m)\), the \(CO_2\) concentration in \(A\) \((mg\;m^{-3})\), the rate of change of \(CO_2\) concentration in \(A\) \((mg\;m^{-3}\;s^{-1})\), and the net \(CO_2\) flux from \(A\) to \(B\) \((mg\;m^{-2}\;s^{-1})\), where \(Air\) and \(Top\) represent the lower and upper compartments, \(Blow\) represents the direct air heater, \(Ext\) represents the source from the third party, \(Pad\) represents the pad system, \(Can\) represents the total foliage of the plants inside the greenhouse, and \(Out\) represents the space outside the greenhouse.

In order to solve the equations, we must consider the formulas that calculate each \(MC_{AB}\) that was presented.

The amount of \(CO_2\) going from the direct air heater into the greenhouse air is given by taking the product of the capacity \(P_{Blow}\) \((W)\) of the heater, the amount of \(CO_2\) generated for each Joule of sensible heat released by the heater \(\eta_{HeatCO_2}\) \((mg_{CO_2}\;J^{-1})\), and the dimensionless parameter \(U_{Blow}\), then dividing it by the area of the greenhouse \(A_{Flr}\) \((m^2)\).
\begin{gather}
  MC_{BlowAir} = \frac{\eta_{HeatCO_2}U_{Blow}}{A_{Flr}}
\end{gather}

Similarly, the amount of \(CO_2\) that is pumped into the greenhouse by the third party equals the third party's ability to pump \(CO_2\) \(\phi_{ExtCO_2}\) \((mg\;s^{-1})\) times the dimensionless parameter \(U_{ExtCO_2}\), then divided by the area of the greenhouse.
\begin{gather}
  MC_{ExtAir} = \frac{U_{ExtCO_2}\phi_{ExtCO_2}}{A_{Flr}}
\end{gather}

The amount of \(CO_2\) that enters the greenhouse through the pad system is calculated differently.
It depends on the difference between the concentration of \(CO_2\) inside and outside the greenhouse, and the ability of the pad system for the air to go through.
As the pad can be adjusted to let more air in, the flux of the pad \(f_{Pad}\) \((m^{-1})\) can be given as the product of the permeability of the pad \(U_{Pad}\) and the ability for the airflow to pass through \(\phi_{Pad}\) \((m^3\;s^{-1})\) divided by the area of the greenhouse floor.
\begin{equation}
  \begin{split}
    MC_{PadAir} & = f_{Pad} (CO_{2 Out} - CO_{2 Air}) \\
    & = \frac{U_{Pad} \phi_{Pad}}{A_{Flr}} (CO_{2 Out} - CO_{2 Air})
  \end{split}
\end{equation}

The net flux of \(CO_2\) from the lower compartment to the upper compartment of the greenhouse is more complicated.
It depends on the difference in temperature and air density between the two compartments and the airflow rate through the thermal screen \(f_{ThScr}\) \((m\;s^{-1})\).
\begin{gather}
  MC_{AirTop} = f_{ThScr} (CO_{2 Air} - CO_{2 Top})
\end{gather}

Furthermore, \(f_{ThScr}\) is given by
\begin{gather}
  f_{ThScr} = U_{ThScr} K_{ThScr} |T_{Air} - T_{Top}| ^{\frac{2}{3}} + (1 - U_{ThScr}) {\Bigg[\frac{g(1 - U_{ThScr})W}{2\rho^{Mean}_{Air}} |\rho_{Air} - \rho_{Top}|\Bigg]}^{\frac{1}{2}}
\end{gather}

To calculate the the airflow rate, we consider the screen and the open regions separately, with \(U_{ThScr} \in [0,1]\) representing the percentage of places that are covered by the thermal screen. The flux through the screen depends on the difference between the temperature above and below the screen and the permeability of the screen \(K_{ThScr}\) \((m\;K^{-\frac{2}{3}}\;s^{-1})\).

At places that are not covered by the thermal screen, the flux is given by a Navier-Stokes equation depending on the difference of the air density below the screen \(\rho_{Air}\) and the air density above the screen \(\rho_{Top}\) \((kg\;m^{-3})\). \(W\) \((m)\) is width of the thermal screen.

The net \(CO_2\) flux from the inside to the outside of the greenhouse is given by the following formula
\begin{gather}
  MC_{AirOut} = (f_{VentSide} + f_{VentForced})(CO_{2 Air} - CO_{2 Out})
\end{gather}

The flux \(f_{VentSide}\) and \(f_{VentForced}\) \((m s^{-1})\) are respectively the flux due to the fan system on the sidewalls and the fan system inside the greenhouse.

%In this case, we should consider the Bernoulli principle in representing the pressure difference outside and inside of the greenhouse.

\begin{equation} \label{eq:vent_roof_side}
  \begin{split}
    f_{VentRoofSide} & = \frac{C_d}{A_{Flr}} \Bigg[\frac{U^2_{Roof} U^2_{Side} A^2_{Roof} A^2_{Side}}{U^2_{Roof} A^2_{Roof} + U^2_{Side} A^2_{Side}} .\times \frac{2gh_{SideRoof} (T_{Air} - T_{Out})}{T^{Mean}_{Air}} \\
    &\;+ \Bigg(\frac{U_{Roof} A_{Roof} + U_{Side} A_{Side}}{2}\Bigg)^2 + C_W v^2_{Wind} \Bigg]^{\frac{1}{2}}
  \end{split}
\end{equation}

The above formula is the sum of the two components multiplied with the ratio between the discharged coefficient \(C_d\) and the area of the greenhouse \(A_{Flr}\) \((m^2)\).

The first component represents the Stack effect when the ventilation area on the roof \(A_{Roof}\) \((m^2)\) is non-zero. Stack effect happens when there exists a temperature difference between the interior and exterior of the building. In this case, the first component in the formula is given based on the equation of the Stack effect, that is caused by the temperature difference between the outside and inside of the greenhouse (the space under the thermal screen).
The second component is given by the pressure difference inside and outside the greenhouse. The pressure from the outside of the greenhouse is caused by the natural airflow through the roof surface, while the pressure from the inside of the greenhouse is caused by the lateral airflow. Based on the Bernoulli principle, the pressure difference can be calculated as the total area of the ventilation openings on the greenhouse divided by two times the natural wind speed \(v_{Wind}\) \((m\;s^{-1})\) squared and the global wind pressure coefficient \(C_w\) (dimensionless).

In the presence of an insect screen, the movement speed of the air currents through the ventilation areas will be reduced by a factor of \(\eta_{InsScr}\), where \(\zeta_{InsScr}\) is the porosity, the ratio of the area of the holes in the screen to the total area of the screen.
\begin{gather}
  \eta_{InsScr} = \zeta_{InsScr} (2 -  \zeta_{InsScr})
\end{gather}

Given the leakage coefficient \(c_{leakage}\), which depends on the greenhouse type and is dimensionless, an amount of approximately half the leakage rate is added to the air-exchange rate, where leakage rate is calculated as below.
\begin{gather}
  f_{leakage} = \begin{cases}
    0.25 \times c_{leakage}     & \text{if} v_{Wind} < 0.25    \\
    v_{Wind} \times c_{leakage} & \text{if} v_{Wind} \geq 0.25
  \end{cases}
\end{gather}

Let \(\eta_{Side\_Thr}\) be the Stack-effect threshold. If \(\eta_{Side}\), the ratio between the sidewalls ventilation
area and the total ventilation area, exceeds the threshold, the Stack effect does not occur and vice versa. Then, \(f_{VentSide}\) is given by the following
\begin{gather}
  f_{VentSide} =
  \begin{cases}
    \eta_{InsScr} f''_{VentSide} + 0.5f_{leakage} & \text{if} \eta_{Side} \geq \eta_{Side\_Thr} \\
    \begin{split}
      & \eta_{InsScr} [U_{ThScr}f''_{VentSide} + \\
      & (1-U_{ThScr})f_{VentRoofSide} \eta_{Side}] + 0.5 f_{leakage}
    \end{split}                    & \text{if} \eta_{Side} < \eta_{Side\_Thr}
  \end{cases}
\end{gather}

In which,  \(f''_{VentSide}\) is  \(f_{VentSide}\) when \(A_{Roof} = 0\).
Moreover, the Stack effect does not occur where is covered by the thermal screen.

The flux \(f_{VentForced}\) by the fan system inside the greenhouse is calculated as follows.
\begin{gather}
  f_{VentForced} = \frac{\eta_{InsScr} U_{VentForced} \phi_{VentForced} } {A_{Flr}}
\end{gather}

The dimensionless parameter \(U_{VentForced} \in [0,1]\) is to adjust the wind speed \(\phi_{VentForced}\) due to
the system \((m^3\;s^{-1})\).

Similarly to \(MC_{AirOut}\), the net \(CO_2\) flux from the greenhouse to outside the greenhouse through the roof openings is calculated by using the formula below, where \(f_{VentRoof}\) is the flux rate through the roof openings.
\begin{gather}
  MC_{TopOut} = f_{VentRoof}(CO_{2 Top} - CO_{2 Out})
\end{gather}

\(f_{VentRoof}\) is the flux rate openings and is given by
\begin{gather}
  f_{VentRoof} =
  \begin{cases}
    \eta_{InsScr} f''_{VentRoof} + 0.5f_{leakage} & \text{if} \eta_{Roof} \geq \eta_{Roof\_Thr} \\
    \begin{split}
      & \eta_{InsScr} [U_{ThScr}f''_{VentRoof} + \\
      & (1-U_{ThScr})f_{VentRoofSide} \eta_{Side}] + 0.5 f_{leakage}
    \end{split}                    & \text{if}  \eta_{Roof} < \eta_{Roof\_Thr}
  \end{cases}
\end{gather}

% check again part
However, when the ratio of the roof-opening area to the total ventilation area exceeds the Stack-effect threshold, the Stack effect does not occur and we cannot reuse the formula~\ref{eq:vent_roof_side} where \(A_{Side} = 0\) to
calculate \(f''_{VentRoof}\).
\begin{gather}
  f''_{VentRoof} = \frac{C_d U_{Roof} A_{Roof}}{2A_{Flr}} {\Big[\frac{gh_{Roof}(T_{Air} - T_{Out})}{2T^{Mean}_{Air}} + C_w v^2_{Wind} \Big]}^{ \frac{1}{2}}
\end{gather}

Finally, we need to consider the amount of \(CO_2\) absorbed into the leaves due to photosynthesis.
\begin{gather}
  MC_{AirCan} = M_{CH_2O} h_{C_{Buf}} (P - R)
\end{gather}

Here, \(M_{CH_2O}\) is the molar mass of \(CH_2O\) \((mg\;\mu mol^{-1})\), \(P\) is the photosynthetic rate \((\mu mol_{CO_2}\;m^{-2}\;s{-1})\), \(R\) is the respiration rate \((\mu mol_{CO_2}\;m^{-2}\;s^{-1})\), and \(h_{C_{Buf}}\) shows the cessation of photosynthesis when \(CH_2O\) is \(C_{Buf}\) \((mg\;m^{-2})\) has reached \(C_{Max}\) \((mg\;m^{-2})\), which is the limit of the carbohydrates storage of the plants. The respiration rate during this process is usually as about \(1\%\) of the photosynthesis rate, and thus can be omitted during further calculation. The photosynthesis rate is described in more detail in Chapter 4.

%%%%%%%%%%%


\subsubsection{Photosynthesis of C3 plants}
\setcounter{equation}{19}
Photosynthesis, the process by which green plants and certain other organisms transform light energy into chemical energy. During photosynthesis in green plants, light energy is captured and used to convert water, carbon dioxide, and minerals into oxygen and energy-rich organic compounds.

Photosynthesis has two phases consisting of the light-dependence phase and the light-independence (or dark) phase.

The photosynthetic rate \(P\) is defined as the diffusion of \(CO_2\) from air into the leaf cells through stomata. From Fick's law for gas diffusion, we construct:
\begin{gather}
  P = \frac{CO_{2Air} - CO_{2Stom}}{Res}
\end{gather}

The notation \(CO_{2Stom}\) is the concentration of CO2 in the stomata \((\mu mol\;m^{-3})\) and \(Res\) is the resistance-to-absorption coefficient \((s\;m^{-1})\).

This way of calculating photosynthetic rate \(P\) is different from the model of Vanthoor 2011. In there the author uses:

\begin{gather}
  P = \frac{J \cdot (CO_{2Stom} - \Gamma)}{4 \cdot (CO_{2Stom} + 2\Gamma)}
\end{gather}

where \(J\) \((\mu mol \{e^-\} m^{-2} s^{-1})\) is the electron transport rate, 4 \((\mu mol \{e^-\} \mu mol^{-1} \{CO2\})\) is the
number of electrons per fixed \(CO_2\) molecule, \(CO_{2Stom}\) \((\mu mol\{CO_2\}\;mol^{-1}\{air\})\) is the \(CO_2\) concentration in the stomata and \(\Gamma\) \((\mu mol \{CO_2\} mol^{-1} \{air\})\) is the \(CO_2\) compensation point.

Following by the photorespiration \(R\):
\begin{gather}
  R = P \cdot \frac{\Gamma}{CO_{2Stom}}
\end{gather}

But since we do not consider electron transport rate, we will use equation $(20)$ constructed from Fick's law combined with Michaelis-Menten model.

In the dark phase, through Michaelis-Menten relationship describing enzyme-substrate reaction, the photosynthetic rate is given by:
\begin{gather}
  P = \frac{P_{Max} \cdot CO_{2Stom}}{CO_{2 0.5} + CO_{2Stom}}
\end{gather}
where \(CO_{2 0.5}\) is the concentration of CO2 in the substrate when \(P = P_{Max}/2\) \((\mu mol\;m^{-3})\).

From $(20)$ and $(21)$, we form a quadratic equation for the rate of photosynthetic \(P\). The photosynthetic rate \(P\) then no longer depends on the concentration of \(CO_2\) in the stomata but only on the concentration of \(CO_2\) in the air, the resistance coefficient Res, and the maximum photosynthetic rate.
\begin{gather}
  ResP^2 - (CO_{2Air} + CO_{2 0.5} + ResP_{Max})P + CO_{2Air}P_{Max} = 0
\end{gather}

Solving equation $(22)$ requires \(P_{Max}\) to be obtained. For the model for the photosynthesis of one leaf unit, the maximum photosynthetic rate is usually be found through the Arrhenius model.
\begin{gather}
  k(T) = k(T_0)e^{-\frac{H_a}{R}(\frac{1}{T} - \frac{1}{T_0})}
\end{gather}
where \(k(T)\) is the reaction rate at \(T (K)\), \(T_0\) is the optimum temperature for which the reaction
rate is known \((K)\), \(H_a\) is the activation energy for the reaction \((J\;mol^{-1})\), and \(R\) is the ideal gas constant.

Yet a problem is raised when the temperature increases to a certain threshold, the enzyme activity will be inhibited and the photosynthesis is slowed down and cease to advance. A model represents the activity of the Rubisco enzyme during photosynthesis with temperature as its parameter.
\begin{gather}
  f(T) = \frac{1 + e^{-\frac{H_d}{R}( \frac{1}{T_0} - \frac{1}{\frac{H_d}{S}} )}}{1 + e^{-\frac{H_d}{R}(\frac{1}{T} - \frac{1}{\frac{H_d}{S}})}}
\end{gather}
In the model $(24)$, \(f(T)\) represents the enzyme activity at \(T(K)\), \(H_d\) is the deactivation energy \((J\;mol^{-1})\), and \(S\) is the corresponding entropy quantity \((J\;mol^{-1}\;K^{-1})\).

Combining $(23)$ and $(24)$, we obtain the formula for maximum rate of photosynthetic rate.
\begin{gather}
  P_{Max}(T) = k(T)f(T)
\end{gather}

For a photosynthesis for the whole canopy, considering \(LAI\) (leaf area index), due to Beer's law, the intensity of the transmitted beam \(I\) with the initial state is \(I_0\) \((\mu mol\{photons\}\;m^{-2}\;s^{-1})\) is equal to
\begin{gather}
  I = \frac{I_0.K.e^{-K.LAI}}{1 - m}
\end{gather}

If the leaves are horizontally stratified such as in the case of tomato, the dimensionless extinction coefficient \(K\) will be between 0.7 and 1.0. Meanwhile, if the leaves are sloping as in the case of wet rice, \(K\) will be between 0.3 and 0.5. \(m\) is the transmittance coefficient of the leaves which is set as 0.1.

The amount of light absorbed by the canopy can be measured as the difference in the intensity of the light ray before entering the foliage and after passing through the foliage
\begin{gather}
  L =L_0(1 - \frac{K.e^{-K.LAI}}{1 - m})
\end{gather}

In this formula, L is luminous flux received by the leaves per unit area of the greenhouse floor \((\mu mol\{photons\}\;m^{-2}\;s^{-1})\) and \(L_0\) is the initial value of L.

For calculating the maximum photosynthetic rate of all leaves in the greenhouse, we apply the modified Arrhenius model.
\begin{gather}
  k(T) = LAI \cdot k(T_0) \cdot e^{-\frac{H_a}{R}(\frac{1}{T} - \frac{1}{T_0})}
\end{gather}

Here, \(k(T)\) is the reaction rate for the whole canopy at \(T (K)\) and \(k(T_0)\) is the reaction rate under the optimal condition \(T_0\) \(K\) of one leaf unit.

Unlike the photosynthesis model for one leaf unit, the amount of light energy absorbed into the foliage in response to \(LAI\) needs to be added since it affects the maximum photosynthetic rate \(P_{Max}\). Therefore, we consider the following formula of \(P_{Max}\), which is a dependent function on \(L\) and \(T\).
\begin{gather}
  P_{Max} (L,T) = \frac{P_{MLT} \cdot P_{Max}(T) \cdot L}{L + L_{0.5}}
\end{gather}

In which, \(L_{0.5}\) is light intensity when \(P_{Max} (L,T) = PMax(T)/2\) \((\mu mol\{photons\}\;m^{-2}\;s^{-1})\)
\(P_{Max}(T)\) is calculated by using the formula (25) with \(k(T)\) as in (28), and \(P_{MLT}\) are the maximum
photosynthetic rate at the point of light saturation and the optimal temperature \(T\).


\subsection{Implementing the programs}
% TODO


\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Testing the programs}
% TODO


\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Exercise 4}
\subsection{Euler and Runge-Kutta of order 4 algorithms as computer programs}
% TODO

\subsection{Predicting \(CO_2\) concentration and comparing to actual data}
% TODO


\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{A dynamical system for vapor pressure}
% TODO

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{overview}
  \caption{Overview of the greenhouse model}\label{fig:overview}
\end{figure}

In this section, a dynamical system representing the vapor pressure in the greenhouse will be addressed.
The model was based on the following assumption:
1) the greenhouse air is considered to be a ``perfectly stirred tank'', meaning that there are no spatial differences in temperature, vapor pressure and the \(CO_2\) concentration; thus all the model fluxes are described per square metre of greenhouse floor;
2) to describe the effect of the thermal screen on the indoor climate, the greenhouse air was divided into two compartments: one below and one above the thermal screen.

From figure~\ref{fig:overview}, the vapor pressure of the greenhouse air \(VP_{Air}\) and the top compartment \(VP_{Top}\) are described by: \\
\begin{multline}
  cap_{VP_{Air}}\dot{VP_{Air}} = MV_{CanAir} + MV_{PadAir} + MV_{FogAir} + MV_{BlowAir} \\
  - MV_{AirThScr} - MV_{AirTop} - MV_{AirOut} \\
  - MV_{AirOut\_Pad} - MV_{AirMech} ~~~~ [kg\;m^{-2}\;s^{-1}]
\end{multline}
\begin{equation}
  cap_{VP_{Top}}\dot{VP_{Top}} = MV_{AirTop} - MV_{TopCov,in} - MV_{TopOut} ~~~~~~~~ [kg\;m^{-2}\;s^{-1}]
\end{equation}
The notations \(cap_X\), \(VP_X\), \(\dot{VP_X}\) and \(MV_{XY}\) are respectively the capacity to store vapor pressure in X (\(kg\;m^3\;J^{-1}\)),
the vapor pressure in X (\(Pa\)), the rate of change of vapor pressure in X (\(Pa\;s^{-1}\)), and the net vapor flux from X to Y (\(kg\;m^{-2}\;s^{-1}\)),
where \(Air\) and \(Top\) denote the lower and upper compartments, \(Can\) represents the canopy, \(Pad\) represents the pad system, \(Fog\) represents the fogging system,
\(Blow\) represents the direct air heater, \(ThScr\) represents the thermal screen, \(Out\) represents the outdoor air,
\(Out\_Pad\) represents the outdoor air due to the air exchange caused by the pad and fan system, \(Mech\) represents the mechanical cooling system,
and \(Cov,in\) represents the internal cover layer.

The vapor exchange coefficient between the air and an object is linearly related to the convective heat exchange coefficient between the air and the object.
Therefore, the vapor flux from the air to an object by condensation is described by:
\begin{equation}
  MV_{12} = \begin{cases}
    0                                        & VP_1 < VP_2 \\
    6.4 \times 10^{-9} HEC_{12}(VP_1 - VP_2) & VP_1 > VP_2 \\
  \end{cases}
  ~~~~~~~~ [kg\;m^{-2}\;s^{-1}]
\end{equation}
% TODO


\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Exercise 6}
\subsection{(a)}
% TODO

\subsection{(b)}
% TODO

\subsection{(c)}
% TODO

\begin{thebibliography}{80}


  \bibitem{bib1}
  % TODO


  \bibitem{bib2}
  % TODO


\end{thebibliography}
\end{document}

